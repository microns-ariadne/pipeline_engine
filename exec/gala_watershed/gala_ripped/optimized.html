<!DOCTYPE html>
<!-- Generated by Cython 0.20.1post0 (Debian 0.20.1+git90-g0e6e38e-1ubuntu2) on Sat Jan 24 04:40:08 2015 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display != 'block') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.20.1post0 (Debian 0.20.1+git90-g0e6e38e-1ubuntu2) on Sat Jan 24 04:40:08 2015
<p>Raw output: <a href="optimized.c">optimized.c</a>
<pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1")'> 1: import numpy as np</pre>
<pre id='line1' class='code' style='background-color: #FFFF57'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: cimport numpy as np</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: </pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line4")'> 4: def despeckle_watershed(ws, in_place=True):</pre>
<pre id='line4' class='code' style='background-color: #FFFF2a'>/* Python wrapper */
static PyObject *__pyx_pw_4gala_9optimized_1despeckle_watershed(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4gala_9optimized_despeckle_watershed[] = " Function to clean up dots in an initial oversegmentation. \n\n    If all instances of a label are surrounded by one second label, then we\n    change those pixels to the second label. Useful for dealing with tiny dots\n    when running watershed on un-thresholded probability maps. Assumes all\n    labels appear only on one contiguous blob.\n\n    Parameters\n    ----------\n    ws : ndarray of 2 or 3 dimensions\n        an image or stack of images to be cleaned up. If it is a stack, each\n        plane is considered separately. \n    in_place : boolean, optional\n        whether to modify the original images or create a copy. \n        defaults to True.\n\n    Returns\n    -------\n    out : ndarray, same shape and type as `ws`\n        the original image with all holes filled in their surrounding label\n    ";
static PyMethodDef __pyx_mdef_4gala_9optimized_1despeckle_watershed = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("despeckle_watershed"), (PyCFunction)__pyx_pw_4gala_9optimized_1despeckle_watershed, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_4gala_9optimized_despeckle_watershed)};
static PyObject *__pyx_pw_4gala_9optimized_1despeckle_watershed(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ws = 0;
  PyObject *__pyx_v_in_place = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("despeckle_watershed (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ws,&amp;__pyx_n_s_in_place,0};
    PyObject* values[2] = {0,0};
    values[1] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_ws)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_in_place);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "despeckle_watershed") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ws = values[0];
    __pyx_v_in_place = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("despeckle_watershed", 0, 1, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.despeckle_watershed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4gala_9optimized_despeckle_watershed(__pyx_self, __pyx_v_ws, __pyx_v_in_place);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4gala_9optimized_despeckle_watershed(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ws, PyObject *__pyx_v_in_place) {
  int __pyx_v_ii;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("despeckle_watershed", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ws);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.despeckle_watershed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ws);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_ws, __pyx_n_s_in_place, __pyx_n_s_ii);<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4gala_9optimized_1despeckle_watershed, NULL, __pyx_n_s_gala_optimized);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_despeckle_watershed, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__27 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_scratch_neuro_segmentation_gala, __pyx_n_s_despeckle_watershed, 4, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5:     """ Function to clean up dots in an initial oversegmentation.</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: </pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7:     If all instances of a label are surrounded by one second label, then we</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8:     change those pixels to the second label. Useful for dealing with tiny dots</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9:     when running watershed on un-thresholded probability maps. Assumes all</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10:     labels appear only on one contiguous blob.</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: </pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12:     Parameters</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13:     ----------</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14:     ws : ndarray of 2 or 3 dimensions</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15:         an image or stack of images to be cleaned up. If it is a stack, each</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16:         plane is considered separately.</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17:     in_place : boolean, optional</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18:         whether to modify the original images or create a copy.</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19:         defaults to True.</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: </pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21:     Returns</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22:     -------</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23:     out : ndarray, same shape and type as `ws`</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24:         the original image with all holes filled in their surrounding label</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25:     """</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26:     cdef int ii</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line27")'> 27:     if not in_place: ws = ws.copy()</pre>
<pre id='line27' class='code' style='background-color: #FFFF8d'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_in_place);<span class='error_goto'> if (unlikely(__pyx_t_1 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = ((!__pyx_t_1) != 0);
  if (__pyx_t_2) {
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_ws, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_ws, __pyx_t_4);
    __pyx_t_4 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line28")'> 28:     if ws.ndim == 3:</pre>
<pre id='line28' class='code' style='background-color: #FFFF79'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_ws, __pyx_n_s_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_int_3, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line29")'> 29:         for ii in range(ws.shape[0]):</pre>
<pre id='line29' class='code' style='background-color: #FFFF8d'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_ws, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_ii = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line30")'> 30:             ws[ii,:,:] = _despeckle_2d_watershed(ws[ii,:,:])</pre>
<pre id='line30' class='code' style='background-color: #FFFF24'>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ii);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
  __pyx_slice_ = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice_);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_slice_);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice_);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_slice__2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__2);
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_ws, __pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_t_4);
      if (unlikely(!__pyx_t_7.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __pyx_f_4gala_9optimized__despeckle_2d_watershed(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ii);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_slice__2 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__2);
  __pyx_slice__3 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_slice__3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, __pyx_slice__4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__4);
      __pyx_t_3 = 0;
      if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_ws, __pyx_t_8, __pyx_t_4) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    }
  __pyx_slice__4 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__4);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line31")'> 31:         return ws</pre>
<pre id='line31' class='code' style='background-color: #FFFFd4'>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ws);
    __pyx_r = __pyx_v_ws;
    goto __pyx_L0;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32:     else:</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line33")'> 33:         return _despeckle_2d_watershed(ws)</pre>
<pre id='line33' class='code' style='background-color: #FFFFc4'>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_v_ws);
    if (unlikely(!__pyx_t_7.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_4 = __pyx_f_4gala_9optimized__despeckle_2d_watershed(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: </pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35: </pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line36")'> 36: cdef _despeckle_2d_watershed(long[:,:] ws):</pre>
<pre id='line36' class='code' style='background-color: #FFFF7f'>static PyObject *__pyx_f_4gala_9optimized__despeckle_2d_watershed(__Pyx_memviewslice __pyx_v_ws) {
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_i_offset;
  int __pyx_v_j_offset;
  int __pyx_v_label;
  PyObject *__pyx_v_neighborhoods = NULL;
  PyObject *__pyx_v_replacements = NULL;
  PyObject *__pyx_v_neighbors = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_despeckle_2d_watershed", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_24);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_25);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._despeckle_2d_watershed", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_neighborhoods);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_replacements);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_neighbors);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:     """ workhorse function for despeckle_watershed, see its documentation """</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:     cdef int ii, jj, i_offset, j_offset, label</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line39")'> 39:     neighborhoods = {}</pre>
<pre id='line39' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_neighborhoods = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line40")'> 40:     replacements = {}</pre>
<pre id='line40' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_replacements = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41:     for ii in range(ws.shape[0]):</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'>  __pyx_t_2 = (__pyx_v_ws.shape[0]);
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_ii = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:         for jj in range(ws.shape[1]):</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'>    __pyx_t_4 = (__pyx_v_ws.shape[1]);
    for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
      __pyx_v_jj = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line43")'> 43:             if ws[ii,jj] not in neighborhoods:</pre>
<pre id='line43' class='code' style='background-color: #FFFF96'>      __pyx_t_6 = __pyx_v_ii;
      __pyx_t_7 = __pyx_v_jj;
      __pyx_t_8 = -1;
      if (__pyx_t_6 &lt; 0) {
        __pyx_t_6 += __pyx_v_ws.shape[0];
        if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_ws.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_ws.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_ws.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_6 * __pyx_v_ws.strides[0]) ) + __pyx_t_7 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_9 = (<span class='pyx_c_api'>__Pyx_PyDict_Contains</span>(__pyx_t_1, __pyx_v_neighborhoods, Py_NE));<span class='error_goto'> if (unlikely(__pyx_t_9 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = (__pyx_t_9 != 0);
      if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line44")'> 44:                 neighborhoods[ws[ii,jj]] = []</pre>
<pre id='line44' class='code' style='background-color: #FFFF62'>        __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_8 = __pyx_v_ii;
        __pyx_t_11 = __pyx_v_jj;
        __pyx_t_12 = -1;
        if (__pyx_t_8 &lt; 0) {
          __pyx_t_8 += __pyx_v_ws.shape[0];
          if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_12 = 0;
        } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_ws.shape[0])) __pyx_t_12 = 0;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_ws.shape[1];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_12 = 1;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_ws.shape[1])) __pyx_t_12 = 1;
        if (unlikely(__pyx_t_12 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_12);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_8 * __pyx_v_ws.strides[0]) ) + __pyx_t_11 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_neighborhoods, __pyx_t_13, __pyx_t_1) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line45")'> 45:             for i_offset in [-1, 0, 1]:</pre>
<pre id='line45' class='code' style='background-color: #FFFF73'>      __pyx_t_1 = __pyx_tuple__5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_14 = 0;
      for (;;) {
        if (__pyx_t_14 &gt;= 3) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_13 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_14); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13); __pyx_t_14++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_13 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_14); __pyx_t_14++;<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_13);<span class='error_goto'> if (unlikely((__pyx_t_12 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_v_i_offset = __pyx_t_12;
/* … */
  __pyx_tuple__5 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_int_neg_1, __pyx_int_0, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__5);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:                 if i_offset+ii &lt; 0 or i_offset+ii &gt;= ws.shape[0]:</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'>        __pyx_t_10 = (((__pyx_v_i_offset + __pyx_v_ii) &lt; 0) != 0);
        if (!__pyx_t_10) {
          __pyx_t_9 = (((__pyx_v_i_offset + __pyx_v_ii) &gt;= (__pyx_v_ws.shape[0])) != 0);
          __pyx_t_15 = __pyx_t_9;
        } else {
          __pyx_t_15 = __pyx_t_10;
        }
        if (__pyx_t_15) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:                     continue</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'>          goto __pyx_L8_continue;
        }
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line48")'> 48:                 for j_offset in [-1, 0, 1]:</pre>
<pre id='line48' class='code' style='background-color: #FFFF73'>        __pyx_t_13 = __pyx_tuple__6; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13); __pyx_t_16 = 0;
        for (;;) {
          if (__pyx_t_16 &gt;= 3) break;
          #if CYTHON_COMPILING_IN_CPYTHON
          __pyx_t_17 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_13, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17); __pyx_t_16++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          #else
          __pyx_t_17 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_13, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          #endif
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_17);<span class='error_goto'> if (unlikely((__pyx_t_12 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          __pyx_v_j_offset = __pyx_t_12;
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_int_neg_1, __pyx_int_0, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:                     if j_offset+jj &lt; 0 or j_offset+jj &gt;= ws.shape[1]:</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'>          __pyx_t_15 = (((__pyx_v_j_offset + __pyx_v_jj) &lt; 0) != 0);
          if (!__pyx_t_15) {
            __pyx_t_10 = (((__pyx_v_j_offset + __pyx_v_jj) &gt;= (__pyx_v_ws.shape[1])) != 0);
            __pyx_t_9 = __pyx_t_10;
          } else {
            __pyx_t_9 = __pyx_t_15;
          }
          if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:                         continue</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'>            goto __pyx_L11_continue;
          }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line51")'> 51:                     label = ws[ii+i_offset, jj+j_offset]</pre>
<pre id='line51' class='code' style='background-color: #FFFFd4'>          __pyx_t_12 = (__pyx_v_ii + __pyx_v_i_offset);
          __pyx_t_18 = (__pyx_v_jj + __pyx_v_j_offset);
          __pyx_t_19 = -1;
          if (__pyx_t_12 &lt; 0) {
            __pyx_t_12 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_19 = 0;
          } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_ws.shape[0])) __pyx_t_19 = 0;
          if (__pyx_t_18 &lt; 0) {
            __pyx_t_18 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_19 = 1;
          } else if (unlikely(__pyx_t_18 &gt;= __pyx_v_ws.shape[1])) __pyx_t_19 = 1;
          if (unlikely(__pyx_t_19 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_19);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_v_label = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_12 * __pyx_v_ws.strides[0]) ) + __pyx_t_18 * __pyx_v_ws.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line52")'> 52:                     if label == ws[ii,jj] or label in neighborhoods[ws[ii,jj]]:</pre>
<pre id='line52' class='code' style='background-color: #FFFF66'>          __pyx_t_19 = __pyx_v_ii;
          __pyx_t_20 = __pyx_v_jj;
          __pyx_t_21 = -1;
          if (__pyx_t_19 &lt; 0) {
            __pyx_t_19 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_21 = 0;
          } else if (unlikely(__pyx_t_19 &gt;= __pyx_v_ws.shape[0])) __pyx_t_21 = 0;
          if (__pyx_t_20 &lt; 0) {
            __pyx_t_20 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_21 = 1;
          } else if (unlikely(__pyx_t_20 &gt;= __pyx_v_ws.shape[1])) __pyx_t_21 = 1;
          if (unlikely(__pyx_t_21 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_21);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_9 = ((__pyx_v_label == (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_19 * __pyx_v_ws.strides[0]) ) + __pyx_t_20 * __pyx_v_ws.strides[1]) )))) != 0);
          if (!__pyx_t_9) {
            __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
            __pyx_t_21 = __pyx_v_ii;
            __pyx_t_22 = __pyx_v_jj;
            __pyx_t_23 = -1;
            if (__pyx_t_21 &lt; 0) {
              __pyx_t_21 += __pyx_v_ws.shape[0];
              if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_23 = 0;
            } else if (unlikely(__pyx_t_21 &gt;= __pyx_v_ws.shape[0])) __pyx_t_23 = 0;
            if (__pyx_t_22 &lt; 0) {
              __pyx_t_22 += __pyx_v_ws.shape[1];
              if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_23 = 1;
            } else if (unlikely(__pyx_t_22 &gt;= __pyx_v_ws.shape[1])) __pyx_t_23 = 1;
            if (unlikely(__pyx_t_23 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_23);
              <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            }
            __pyx_t_24 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_21 * __pyx_v_ws.strides[0]) ) + __pyx_t_22 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_neighborhoods, __pyx_t_24);<span class='error_goto'> if (unlikely(__pyx_t_25 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
            __pyx_t_15 = (<span class='pyx_c_api'>__Pyx_PySequence_Contains</span>(__pyx_t_17, __pyx_t_25, Py_EQ));<span class='error_goto'> if (unlikely(__pyx_t_15 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
            __pyx_t_10 = (__pyx_t_15 != 0);
          } else {
            __pyx_t_10 = __pyx_t_9;
          }
          if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:                         continue</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'>            goto __pyx_L11_continue;
          }
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line54")'> 54:                     neighborhoods[ws[ii,jj]].append(label)</pre>
<pre id='line54' class='code' style='background-color: #FFFF66'>          __pyx_t_23 = __pyx_v_ii;
          __pyx_t_26 = __pyx_v_jj;
          __pyx_t_27 = -1;
          if (__pyx_t_23 &lt; 0) {
            __pyx_t_23 += __pyx_v_ws.shape[0];
            if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_27 = 0;
          } else if (unlikely(__pyx_t_23 &gt;= __pyx_v_ws.shape[0])) __pyx_t_27 = 0;
          if (__pyx_t_26 &lt; 0) {
            __pyx_t_26 += __pyx_v_ws.shape[1];
            if (unlikely(__pyx_t_26 &lt; 0)) __pyx_t_27 = 1;
          } else if (unlikely(__pyx_t_26 &gt;= __pyx_v_ws.shape[1])) __pyx_t_27 = 1;
          if (unlikely(__pyx_t_27 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_27);
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_23 * __pyx_v_ws.strides[0]) ) + __pyx_t_26 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_neighborhoods, __pyx_t_25);<span class='error_goto'> if (unlikely(__pyx_t_17 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
          __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
          __pyx_t_28 = <span class='pyx_c_api'>__Pyx_PyObject_Append</span>(__pyx_t_17, __pyx_t_25);<span class='error_goto'> if (unlikely(__pyx_t_28 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
          __pyx_L11_continue:;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
        __pyx_L8_continue:;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    }
  }
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line55")'> 55:     for label, neighbors in neighborhoods.iteritems():</pre>
<pre id='line55' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = 0;
  __pyx_t_13 = __Pyx_dict_iterator(__pyx_v_neighborhoods, 1, __pyx_n_s_iteritems, (&amp;__pyx_t_4), (&amp;__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  __pyx_t_1 = __pyx_t_13;
  __pyx_t_13 = 0;
  while (1) {
    __pyx_t_5 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_4, &amp;__pyx_t_2, &amp;__pyx_t_13, &amp;__pyx_t_25, NULL, __pyx_t_3);
    if (unlikely(__pyx_t_5 == 0)) break;
    if (unlikely(__pyx_t_5 == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_13);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_v_label = __pyx_t_5;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_neighbors, __pyx_t_25);
    __pyx_t_25 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line56")'> 56:         if len(neighbors) == 1:</pre>
<pre id='line56' class='code' style='background-color: #FFFFaa'>    __pyx_t_14 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_neighbors);<span class='error_goto'> if (unlikely(__pyx_t_14 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = ((__pyx_t_14 == 1) != 0);
    if (__pyx_t_10) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line57")'> 57:             replacements[label] = neighbors[0]</pre>
<pre id='line57' class='code' style='background-color: #FFFF79'>      __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_neighbors, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_25 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_replacements, __pyx_t_13, __pyx_t_25) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      goto __pyx_L17;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58:         else:</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line59")'> 59:             replacements[label] = label</pre>
<pre id='line59' class='code' style='background-color: #FFFF73'>      __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_label);<span class='error_goto'> if (unlikely(!__pyx_t_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_replacements, __pyx_t_13, __pyx_t_25) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
    }
    __pyx_L17:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:     for ii in range(ws.shape[0]):</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'>  __pyx_t_4 = (__pyx_v_ws.shape[0]);
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_4; __pyx_t_3+=1) {
    __pyx_v_ii = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61:         for jj in range(ws.shape[1]):</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = (__pyx_v_ws.shape[1]);
    for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_2; __pyx_t_5+=1) {
      __pyx_v_jj = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line62")'> 62:             ws[ii,jj] = replacements[ws[ii,jj]]</pre>
<pre id='line62' class='code' style='background-color: #FFFF73'>      __pyx_t_27 = __pyx_v_ii;
      __pyx_t_29 = __pyx_v_jj;
      __pyx_t_30 = -1;
      if (__pyx_t_27 &lt; 0) {
        __pyx_t_27 += __pyx_v_ws.shape[0];
        if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_30 = 0;
      } else if (unlikely(__pyx_t_27 &gt;= __pyx_v_ws.shape[0])) __pyx_t_30 = 0;
      if (__pyx_t_29 &lt; 0) {
        __pyx_t_29 += __pyx_v_ws.shape[1];
        if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_30 = 1;
      } else if (unlikely(__pyx_t_29 &gt;= __pyx_v_ws.shape[1])) __pyx_t_30 = 1;
      if (unlikely(__pyx_t_30 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_30);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_27 * __pyx_v_ws.strides[0]) ) + __pyx_t_29 * __pyx_v_ws.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_25 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_replacements, __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_25 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_31 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_25);<span class='error_goto'> if (unlikely((__pyx_t_31 == (long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      __pyx_t_30 = __pyx_v_ii;
      __pyx_t_32 = __pyx_v_jj;
      __pyx_t_33 = -1;
      if (__pyx_t_30 &lt; 0) {
        __pyx_t_30 += __pyx_v_ws.shape[0];
        if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_33 = 0;
      } else if (unlikely(__pyx_t_30 &gt;= __pyx_v_ws.shape[0])) __pyx_t_33 = 0;
      if (__pyx_t_32 &lt; 0) {
        __pyx_t_32 += __pyx_v_ws.shape[1];
        if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_33 = 1;
      } else if (unlikely(__pyx_t_32 &gt;= __pyx_v_ws.shape[1])) __pyx_t_33 = 1;
      if (unlikely(__pyx_t_33 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ws.data + __pyx_t_30 * __pyx_v_ws.strides[0]) ) + __pyx_t_32 * __pyx_v_ws.strides[1]) )) = __pyx_t_31;
    }
  }
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line63")'> 63:     return ws</pre>
<pre id='line63' class='code' style='background-color: #FFFFe7'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_25 = __pyx_memoryview_fromslice(__pyx_v_ws, 2, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
  __pyx_r = __pyx_t_25;
  __pyx_t_25 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64: </pre>
<pre id='line64' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF19' onclick='toggleDiv("line65")'> 65: def flood_fill(im, start, acceptable, limits=None, raveled=False):</pre>
<pre id='line65' class='code' style='background-color: #FFFF19'>/* Python wrapper */
static PyObject *__pyx_pw_4gala_9optimized_3flood_fill(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4gala_9optimized_2flood_fill[] = " Find all connected points in a 3D volume.\n\n    Starting from a given point, this function floods into all adjacent\n    points that have an acceptable label.\n\n    Parameters\n    ----------\n    im : 3D ndarray of longs\n        This is the volume in which the flood fill will fill. Each voxel's\n        value is its label and its indices are its position.\n    start : 1D ndarray of longs\n        This gives the position of the first point from which the flood fill \n        will begin. must be length 3.\n    acceptable : 1D ndarray of longs\n        As the flood fills, each pixel is checked to see if its value is in\n        this list. the flood fill continues into that pixel iff it is.\n    limits : 2D ndarray of longs, optional\n        Allows the calling function specify an outer bound for the flood fill.\n        Given as a matrix where each row represents a dimension in im and the\n        first column is the lower bound and the second column is the upper.\n        Defaults to None, which uses the entire volume.\n    raveled : boolean, optional\n        Specifies whether to return the flooded pixels as coordinates or as\n        raveled indices.\n\n    Returns\n    -------\n    matches : ndarray\n        either a 1D array of raveled indices of pixels in im, or a \n        2D ndarray where each row is the coordinates of a pixel.\n    ";
static PyMethodDef __pyx_mdef_4gala_9optimized_3flood_fill = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("flood_fill"), (PyCFunction)__pyx_pw_4gala_9optimized_3flood_fill, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_4gala_9optimized_2flood_fill)};
static PyObject *__pyx_pw_4gala_9optimized_3flood_fill(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_im = 0;
  PyObject *__pyx_v_start = 0;
  PyObject *__pyx_v_acceptable = 0;
  PyObject *__pyx_v_limits = 0;
  PyObject *__pyx_v_raveled = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("flood_fill (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_im,&amp;__pyx_n_s_start,&amp;__pyx_n_s_acceptable,&amp;__pyx_n_s_limits,&amp;__pyx_n_s_raveled,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[3] = ((PyObject *)Py_None);
    values[4] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_im)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_start)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("flood_fill", 0, 3, 5, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_acceptable)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("flood_fill", 0, 3, 5, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_limits);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_raveled);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "flood_fill") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_im = values[0];
    __pyx_v_start = values[1];
    __pyx_v_acceptable = values[2];
    __pyx_v_limits = values[3];
    __pyx_v_raveled = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("flood_fill", 0, 3, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.flood_fill", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4gala_9optimized_2flood_fill(__pyx_self, __pyx_v_im, __pyx_v_start, __pyx_v_acceptable, __pyx_v_limits, __pyx_v_raveled);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4gala_9optimized_2flood_fill(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_im, PyObject *__pyx_v_start, PyObject *__pyx_v_acceptable, PyObject *__pyx_v_limits, PyObject *__pyx_v_raveled) {
  PyArrayObject *__pyx_v_matches = 0;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_s = NULL;
  PyObject *__pyx_v_formatted = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_matches;
  __Pyx_Buffer __pyx_pybuffer_matches;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("flood_fill", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limits);
  __pyx_pybuffer_matches.pybuffer.buf = NULL;
  __pyx_pybuffer_matches.refcount = 0;
  __pyx_pybuffernd_matches.data = NULL;
  __pyx_pybuffernd_matches.rcbuffer = &amp;__pyx_pybuffer_matches;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized.flood_fill", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_matches);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_a);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_s);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_formatted);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_limits);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__28 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_im, __pyx_n_s_start, __pyx_n_s_acceptable, __pyx_n_s_limits, __pyx_n_s_raveled, __pyx_n_s_matches, __pyx_n_s_a, __pyx_n_s_s, __pyx_n_s_formatted);<span class='error_goto'> if (unlikely(!__pyx_tuple__28)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__28);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__28);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4gala_9optimized_3flood_fill, NULL, __pyx_n_s_gala_optimized);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_flood_fill, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__29 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 9, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_scratch_neuro_segmentation_gala, __pyx_n_s_flood_fill, 65, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66:     """ Find all connected points in a 3D volume.</pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67: </pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:     Starting from a given point, this function floods into all adjacent</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69:     points that have an acceptable label.</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70: </pre>
<pre id='line70' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71:     Parameters</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72:     ----------</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73:     im : 3D ndarray of longs</pre>
<pre id='line73' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:         This is the volume in which the flood fill will fill. Each voxel's</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75:         value is its label and its indices are its position.</pre>
<pre id='line75' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:     start : 1D ndarray of longs</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77:         This gives the position of the first point from which the flood fill</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78:         will begin. must be length 3.</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:     acceptable : 1D ndarray of longs</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:         As the flood fills, each pixel is checked to see if its value is in</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:         this list. the flood fill continues into that pixel iff it is.</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:     limits : 2D ndarray of longs, optional</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83:         Allows the calling function specify an outer bound for the flood fill.</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84:         Given as a matrix where each row represents a dimension in im and the</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85:         first column is the lower bound and the second column is the upper.</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:         Defaults to None, which uses the entire volume.</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87:     raveled : boolean, optional</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88:         Specifies whether to return the flooded pixels as coordinates or as</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89:         raveled indices.</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: </pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91:     Returns</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92:     -------</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93:     matches : ndarray</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:         either a 1D array of raveled indices of pixels in im, or a</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:         2D ndarray where each row is the coordinates of a pixel.</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:     """</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97:     cdef np.ndarray[np.int_t, ndim=2] matches</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line98")'> 98:     if im.ndim == 3:</pre>
<pre id='line98' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_int_3, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line99")'> 99:         a = np.array(acceptable)</pre>
<pre id='line99' class='code' style='background-color: #FFFF62'>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_acceptable);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_acceptable);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_acceptable);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_a = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line100")'> 100:         s = np.array(start)</pre>
<pre id='line100' class='code' style='background-color: #FFFF62'>    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_start);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_start);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_start);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_s = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line101")'> 101:         if limits == None:</pre>
<pre id='line101' class='code' style='background-color: #FFFF8d'>    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_limits, Py_None, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_3 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line102")'> 102:             limits = np.array([[0,im.shape[0]-1],[0,im.shape[1]-1],[0,im.shape[2]-1]])</pre>
<pre id='line102' class='code' style='background-color: #FFFF1c'>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_2, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_int_0);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_5 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_5, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_int_0);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_6, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_int_0);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_6);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      __pyx_t_2 = 0;
      __pyx_t_5 = 0;
      __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_limits, __pyx_t_1);
      __pyx_t_1 = 0;
      goto __pyx_L4;
    }
    __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line103")'> 103:         matches = _flood_fill_3d(im, s, a, limits)</pre>
<pre id='line103' class='code' style='background-color: #FFFF43'>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_long</span>(__pyx_v_im);
    if (unlikely(!__pyx_t_7.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_v_s);
    if (unlikely(!__pyx_t_8.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_v_a);
    if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_v_limits);
    if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = __pyx_f_4gala_9optimized__flood_fill_3d(__pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_11 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_12 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_13, &amp;__pyx_t_14, &amp;__pyx_t_15);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_matches, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_13, __pyx_t_14, __pyx_t_15);
        }
      }
      __pyx_pybuffernd_matches.diminfo[0].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matches.diminfo[0].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matches.diminfo[1].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matches.diminfo[1].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[1];
      if (unlikely(__pyx_t_12 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_11 = 0;
    __pyx_v_matches = ((PyArrayObject *)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF39' onclick='toggleDiv("line104")'> 104:         if _list_match(a, im[s[0], s[1], s[2]]) == -1:</pre>
<pre id='line104' class='code' style='background-color: #FFFF39'>    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_v_a);
    if (unlikely(!__pyx_t_16.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_s, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_s, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_s, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    __pyx_t_1 = 0;
    __pyx_t_6 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_im, __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_17 == (long)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __pyx_f_4gala_9optimized__list_match(__pyx_t_16, __pyx_t_17);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
    __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_int_neg_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_3 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line105")'> 105:             return np.array([])</pre>
<pre id='line105' class='code' style='background-color: #FFFF52'>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L0;
    }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line106")'> 106:         if raveled:</pre>
<pre id='line106' class='code' style='background-color: #FFFFd4'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_raveled);<span class='error_goto'> if (unlikely(__pyx_t_3 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    if (__pyx_t_3) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line107")'> 107:             formatted = matches.T</pre>
<pre id='line107' class='code' style='background-color: #FFFFd4'>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_matches), __pyx_n_s_T);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_v_formatted = __pyx_t_5;
      __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line108")'> 108:             return np.ravel_multi_index(formatted, im.shape)</pre>
<pre id='line108' class='code' style='background-color: #FFFF55'>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_ravel_multi_index);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_im, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_formatted);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_formatted);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_formatted);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_5;
      __pyx_t_5 = 0;
      goto __pyx_L0;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109:         else:</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line110")'> 110:             return matches</pre>
<pre id='line110' class='code' style='background-color: #FFFFd4'>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_matches));
      __pyx_r = ((PyObject *)__pyx_v_matches);
      goto __pyx_L0;
    }
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line111")'> 111:     else: raise ValueError("flood fill volume must be 3d!")</pre>
<pre id='line111' class='code' style='background-color: #FFFF7f'>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_ValueError, __pyx_tuple__7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
/* … */
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_flood_fill_volume_must_be_3d);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112: </pre>
<pre id='line112' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line113")'> 113: cdef inline _row_match(long[:,:] rows, long[:] query, long limit):</pre>
<pre id='line113' class='code' style='background-color: #FFFFc4'>static CYTHON_INLINE PyObject *__pyx_f_4gala_9optimized__row_match(__Pyx_memviewslice __pyx_v_rows, __Pyx_memviewslice __pyx_v_query, long __pyx_v_limit) {
  int __pyx_v_rr;
  int __pyx_v_jj;
  int __pyx_v_match;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_row_match", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._row_match", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114:     """ Fast check if the `query` array is a row in `rows`</pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115: </pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116:     Parameters</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117:     ----------</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118:     rows : ndarray, 2 dimensions, type long</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119:         Each row represents a unique potential match.</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120:     query : ndarray, 1 dimension, type long</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121:         The group of numbers we wish to know if appears in `rows`</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     limit : long</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:         Only searches the first `limit` many rows.</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124: </pre>
<pre id='line124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125:     Returns</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126:     -------</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127:     rr : long</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:         The row of the first occurence of `query`, or -1 if not found.</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129:     """</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130:     cdef int rr, jj, match</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131:     for rr in range(limit):</pre>
<pre id='line131' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = __pyx_v_limit;
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_rr = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:         match = 1</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'>    __pyx_v_match = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:         for jj in range(rows.shape[1]):</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = (__pyx_v_rows.shape[1]);
    for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_jj = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line134")'> 134:             if query[jj] != rows[rr,jj]:</pre>
<pre id='line134' class='code' style='background-color: #FFFFb6'>      __pyx_t_5 = __pyx_v_jj;
      __pyx_t_6 = -1;
      if (__pyx_t_5 &lt; 0) {
        __pyx_t_5 += __pyx_v_query.shape[0];
        if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_6 = 0;
      } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_query.shape[0])) __pyx_t_6 = 0;
      if (unlikely(__pyx_t_6 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_6 = __pyx_v_rr;
      __pyx_t_7 = __pyx_v_jj;
      __pyx_t_8 = -1;
      if (__pyx_t_6 &lt; 0) {
        __pyx_t_6 += __pyx_v_rows.shape[0];
        if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_8 = 0;
      } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_rows.shape[0])) __pyx_t_8 = 0;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_rows.shape[1];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_8 = 1;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_rows.shape[1])) __pyx_t_8 = 1;
      if (unlikely(__pyx_t_8 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_9 = (((*((long *) ( /* dim=0 */ (__pyx_v_query.data + __pyx_t_5 * __pyx_v_query.strides[0]) ))) != (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_6 * __pyx_v_rows.strides[0]) ) + __pyx_t_7 * __pyx_v_rows.strides[1]) )))) != 0);
      if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135:                 match = 0</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'>        __pyx_v_match = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line136")'> 136:                 break</pre>
<pre id='line136' class='code' style='background-color: #FFFFff'>        goto __pyx_L6_break;
      }
    }
    __pyx_L6_break:;
</pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line137")'> 137:         if match == 1: return rr</pre>
<pre id='line137' class='code' style='background-color: #FFFFc4'>    __pyx_t_9 = ((__pyx_v_match == 1) != 0);
    if (__pyx_t_9) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_rr);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_r = __pyx_t_10;
      __pyx_t_10 = 0;
      goto __pyx_L0;
    }
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line138")'> 138:     return -1</pre>
<pre id='line138' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  __pyx_r = __pyx_int_neg_1;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139: </pre>
<pre id='line139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFc4' onclick='toggleDiv("line140")'> 140: cdef inline _list_match(long[:] vals, long query):</pre>
<pre id='line140' class='code' style='background-color: #FFFFc4'>static CYTHON_INLINE PyObject *__pyx_f_4gala_9optimized__list_match(__Pyx_memviewslice __pyx_v_vals, long __pyx_v_query) {
  int __pyx_v_jj;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_list_match", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._list_match", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141:     """ Fast check if a long is in a list of longs</pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: </pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143:     Parameters</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144:     ----------</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145:     vals : ndarray, 1 dimension, type long</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:         The list of acceptable values.</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147:     query : long</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:         The value we wish to know whether is in vals.</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line149")'> 149: </pre>
<pre id='line149' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150:     Returns</pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:     -------</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line152")'> 152:     jj : long</pre>
<pre id='line152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153:         The index of the first occurence of query in vals,</pre>
<pre id='line153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154:         or -1 if not found.</pre>
<pre id='line154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155:     """</pre>
<pre id='line155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156:     cdef int jj</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157:     for jj in range(vals.shape[0]):</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_vals.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_jj = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line158")'> 158:         if vals[jj] == query: return jj</pre>
<pre id='line158' class='code' style='background-color: #FFFFaa'>    __pyx_t_3 = __pyx_v_jj;
    __pyx_t_4 = -1;
    if (__pyx_t_3 &lt; 0) {
      __pyx_t_3 += __pyx_v_vals.shape[0];
      if (unlikely(__pyx_t_3 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_3 &gt;= __pyx_v_vals.shape[0])) __pyx_t_4 = 0;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_5 = (((*((long *) ( /* dim=0 */ (__pyx_v_vals.data + __pyx_t_3 * __pyx_v_vals.strides[0]) ))) == __pyx_v_query) != 0);
    if (__pyx_t_5) {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_jj);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_r = __pyx_t_6;
      __pyx_t_6 = 0;
      goto __pyx_L0;
    }
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line159")'> 159:     return -1</pre>
<pre id='line159' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_neg_1);
  __pyx_r = __pyx_int_neg_1;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160: </pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line161")'> 161: cdef _flood_fill_3d(long[:,:,:] im, long[:] start, long[:] acceptable, long[:,:] limits):</pre>
<pre id='line161' class='code' style='background-color: #FFFF32'>static PyObject *__pyx_f_4gala_9optimized__flood_fill_3d(__Pyx_memviewslice __pyx_v_im, __Pyx_memviewslice __pyx_v_start, __Pyx_memviewslice __pyx_v_acceptable, __Pyx_memviewslice __pyx_v_limits) {
  int __pyx_v_frontier_size;
  int __pyx_v_matches_size;
  int __pyx_v_starting_size;
  int __pyx_v_ndim;
  int __pyx_v_base_point_ii;
  int __pyx_v_p_ii;
  int __pyx_v_new_frontier_size;
  int __pyx_v_jj;
  PyArrayObject *__pyx_v_adjacent = 0;
  PyArrayObject *__pyx_v_matches = 0;
  PyArrayObject *__pyx_v_frontier = 0;
  PyArrayObject *__pyx_v_new_frontier = 0;
  PyArrayObject *__pyx_v_base_point = 0;
  PyArrayObject *__pyx_v_p = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_adjacent;
  __Pyx_Buffer __pyx_pybuffer_adjacent;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_base_point;
  __Pyx_Buffer __pyx_pybuffer_base_point;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_frontier;
  __Pyx_Buffer __pyx_pybuffer_frontier;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_matches;
  __Pyx_Buffer __pyx_pybuffer_matches;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_new_frontier;
  __Pyx_Buffer __pyx_pybuffer_new_frontier;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_p;
  __Pyx_Buffer __pyx_pybuffer_p;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_flood_fill_3d", 0);
  __pyx_pybuffer_adjacent.pybuffer.buf = NULL;
  __pyx_pybuffer_adjacent.refcount = 0;
  __pyx_pybuffernd_adjacent.data = NULL;
  __pyx_pybuffernd_adjacent.rcbuffer = &amp;__pyx_pybuffer_adjacent;
  __pyx_pybuffer_matches.pybuffer.buf = NULL;
  __pyx_pybuffer_matches.refcount = 0;
  __pyx_pybuffernd_matches.data = NULL;
  __pyx_pybuffernd_matches.rcbuffer = &amp;__pyx_pybuffer_matches;
  __pyx_pybuffer_frontier.pybuffer.buf = NULL;
  __pyx_pybuffer_frontier.refcount = 0;
  __pyx_pybuffernd_frontier.data = NULL;
  __pyx_pybuffernd_frontier.rcbuffer = &amp;__pyx_pybuffer_frontier;
  __pyx_pybuffer_new_frontier.pybuffer.buf = NULL;
  __pyx_pybuffer_new_frontier.refcount = 0;
  __pyx_pybuffernd_new_frontier.data = NULL;
  __pyx_pybuffernd_new_frontier.rcbuffer = &amp;__pyx_pybuffer_new_frontier;
  __pyx_pybuffer_base_point.pybuffer.buf = NULL;
  __pyx_pybuffer_base_point.refcount = 0;
  __pyx_pybuffernd_base_point.data = NULL;
  __pyx_pybuffernd_base_point.rcbuffer = &amp;__pyx_pybuffer_base_point;
  __pyx_pybuffer_p.pybuffer.buf = NULL;
  __pyx_pybuffer_p.refcount = 0;
  __pyx_pybuffernd_p.data = NULL;
  __pyx_pybuffernd_p.rcbuffer = &amp;__pyx_pybuffer_p;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_26, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_27, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_28, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_35, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._flood_fill_3d", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_adjacent);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_matches);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_frontier);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_new_frontier);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_base_point);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_p);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:     """ Workhorse function for flood_fill, see its documentation.</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:     Assumes im[start] is in acceptable and start is within limits. """</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:     cdef int frontier_size = 1</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'>  __pyx_v_frontier_size = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:     cdef int matches_size = 1</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'>  __pyx_v_matches_size = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:     cdef int starting_size = 5000</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>  __pyx_v_starting_size = 5000;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line167")'> 167:     cdef int ndim = im.ndim</pre>
<pre id='line167' class='code' style='background-color: #FFFF9f'>  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_im, 3, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ndim = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168:     cdef int in_matches, in_acceptable, base_point_ii, p_ii, new_frontier_size, jj</pre>
<pre id='line168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169:     cdef np.ndarray[np.int_t, ndim=2] adjacent</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line170")'> 170:     cdef np.ndarray[np.int_t, ndim=2] matches =      np.zeros([starting_size, ndim], dtype=np.int)</pre>
<pre id='line170' class='code' style='background-color: #FFFF2b'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_starting_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_matches = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_matches.diminfo[0].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matches.diminfo[0].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matches.diminfo[1].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matches.diminfo[1].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_matches = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line171")'> 171:     cdef np.ndarray[np.int_t, ndim=2] frontier =     np.empty([starting_size, ndim], dtype=np.int)</pre>
<pre id='line171' class='code' style='background-color: #FFFF2b'>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_starting_size);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_6 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_frontier = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_frontier.diminfo[0].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_frontier.diminfo[0].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_frontier.diminfo[1].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_frontier.diminfo[1].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_frontier = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line172")'> 172:     cdef np.ndarray[np.int_t, ndim=2] new_frontier = np.empty([starting_size, ndim], dtype=np.int)</pre>
<pre id='line172' class='code' style='background-color: #FFFF2b'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_starting_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_new_frontier = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_new_frontier.diminfo[0].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new_frontier.diminfo[0].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_new_frontier.diminfo[1].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_new_frontier.diminfo[1].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_new_frontier = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173:     cdef np.ndarray[np.int_t, ndim=1] base_point, p</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: </pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175:     for jj in range(ndim):</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = __pyx_v_ndim;
  for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_3; __pyx_t_10+=1) {
    __pyx_v_jj = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line176")'> 176:         frontier[0,jj] = start[jj]</pre>
<pre id='line176' class='code' style='background-color: #FFFFb6'>    __pyx_t_11 = __pyx_v_jj;
    __pyx_t_12 = -1;
    if (__pyx_t_11 &lt; 0) {
      __pyx_t_11 += __pyx_v_start.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_12 = 0;
    } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_start.shape[0])) __pyx_t_12 = 0;
    if (unlikely(__pyx_t_12 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_12);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_13 = 0;
    __pyx_t_12 = __pyx_v_jj;
    __pyx_t_14 = -1;
    if (__pyx_t_13 &lt; 0) {
      __pyx_t_13 += __pyx_pybuffernd_frontier.diminfo[0].shape;
      if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_14 = 0;
    } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_frontier.diminfo[0].shape)) __pyx_t_14 = 0;
    if (__pyx_t_12 &lt; 0) {
      __pyx_t_12 += __pyx_pybuffernd_frontier.diminfo[1].shape;
      if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_14 = 1;
    } else if (unlikely(__pyx_t_12 &gt;= __pyx_pybuffernd_frontier.diminfo[1].shape)) __pyx_t_14 = 1;
    if (unlikely(__pyx_t_14 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_frontier.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_frontier.diminfo[1].strides) = (*((long *) ( /* dim=0 */ (__pyx_v_start.data + __pyx_t_11 * __pyx_v_start.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line177")'> 177:         matches[0,jj] = start[jj]</pre>
<pre id='line177' class='code' style='background-color: #FFFFb6'>    __pyx_t_14 = __pyx_v_jj;
    __pyx_t_15 = -1;
    if (__pyx_t_14 &lt; 0) {
      __pyx_t_14 += __pyx_v_start.shape[0];
      if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 0;
    } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_start.shape[0])) __pyx_t_15 = 0;
    if (unlikely(__pyx_t_15 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    __pyx_t_15 = __pyx_v_jj;
    __pyx_t_17 = -1;
    if (__pyx_t_16 &lt; 0) {
      __pyx_t_16 += __pyx_pybuffernd_matches.diminfo[0].shape;
      if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_17 = 0;
    } else if (unlikely(__pyx_t_16 &gt;= __pyx_pybuffernd_matches.diminfo[0].shape)) __pyx_t_17 = 0;
    if (__pyx_t_15 &lt; 0) {
      __pyx_t_15 += __pyx_pybuffernd_matches.diminfo[1].shape;
      if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_17 = 1;
    } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_matches.diminfo[1].shape)) __pyx_t_17 = 1;
    if (unlikely(__pyx_t_17 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_17);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_matches.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_matches.diminfo[1].strides) = (*((long *) ( /* dim=0 */ (__pyx_v_start.data + __pyx_t_14 * __pyx_v_start.strides[0]) )));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:     while frontier_size &gt; 0:</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>  while (1) {
    __pyx_t_18 = ((__pyx_v_frontier_size &gt; 0) != 0);
    if (!__pyx_t_18) break;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179:         new_frontier_size = 0</pre>
<pre id='line179' class='code' style='background-color: #FFFFff'>    __pyx_v_new_frontier_size = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:         for base_point_ii in range(frontier_size):</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_frontier_size;
    for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_3; __pyx_t_10+=1) {
      __pyx_v_base_point_ii = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line181")'> 181:             base_point = frontier[base_point_ii]</pre>
<pre id='line181' class='code' style='background-color: #FFFF4d'>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_frontier), __pyx_v_base_point_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1);<span class='error_goto'> if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_19 = ((PyArrayObject *)__pyx_t_6);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer);
        __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_17 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_20, &amp;__pyx_t_21, &amp;__pyx_t_22);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_base_point, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_20, __pyx_t_21, __pyx_t_22);
          }
        }
        __pyx_pybuffernd_base_point.diminfo[0].strides = __pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_base_point.diminfo[0].shape = __pyx_pybuffernd_base_point.rcbuffer-&gt;pybuffer.shape[0];
        if (unlikely(__pyx_t_17 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_19 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_base_point, ((PyArrayObject *)__pyx_t_6));
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line182")'> 182:             adjacent = _adjacent_points(base_point, limits)</pre>
<pre id='line182' class='code' style='background-color: #FFFF52'>      __pyx_t_23 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(((PyObject *)__pyx_v_base_point));
      if (unlikely(!__pyx_t_23.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_6 = ((PyObject *)__pyx_f_4gala_9optimized__adjacent_points(__pyx_t_23, __pyx_v_limits));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_23, 1);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
        __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_6), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
        if (unlikely(__pyx_t_17 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_22, &amp;__pyx_t_21, &amp;__pyx_t_20);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_adjacent, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_20);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_22, __pyx_t_21, __pyx_t_20);
          }
        }
        __pyx_pybuffernd_adjacent.diminfo[0].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_adjacent.diminfo[0].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_adjacent.diminfo[1].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_adjacent.diminfo[1].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[1];
        if (unlikely(__pyx_t_17 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_adjacent, ((PyArrayObject *)__pyx_t_6));
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:             for p_ii in range(adjacent.shape[0]):</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'>      __pyx_t_24 = (__pyx_v_adjacent-&gt;dimensions[0]);
      for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_24; __pyx_t_17+=1) {
        __pyx_v_p_ii = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line184")'> 184:                 p = adjacent[p_ii]</pre>
<pre id='line184' class='code' style='background-color: #FFFF4d'>        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_adjacent), __pyx_v_p_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1);<span class='error_goto'> if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_19 = ((PyArrayObject *)__pyx_t_6);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
          __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_19, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
          if (unlikely(__pyx_t_25 &lt; 0)) {
            <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_20, &amp;__pyx_t_21, &amp;__pyx_t_22);
            if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_p, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22);
              <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
            } else {
              <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_20, __pyx_t_21, __pyx_t_22);
            }
          }
          __pyx_pybuffernd_p.diminfo[0].strides = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_p.diminfo[0].shape = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.shape[0];
          if (unlikely(__pyx_t_25 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_19 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_p, ((PyArrayObject *)__pyx_t_6));
        __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line185")'> 185:                 if _list_match(p, -1) != -1:</pre>
<pre id='line185' class='code' style='background-color: #FFFF79'>        __pyx_t_26 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(((PyObject *)__pyx_v_p));
        if (unlikely(!__pyx_t_26.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_6 = __pyx_f_4gala_9optimized__list_match(__pyx_t_26, -1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_26, 1);
        __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_6, __pyx_int_neg_1, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_18 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_18) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:                     continue</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'>          goto __pyx_L9_continue;
        }
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line187")'> 187:                 if _row_match(matches, p, matches_size) &gt; -1:</pre>
<pre id='line187' class='code' style='background-color: #FFFF6e'>        __pyx_t_27 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_matches));
        if (unlikely(!__pyx_t_27.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_28 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(((PyObject *)__pyx_v_p));
        if (unlikely(!__pyx_t_28.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_t_5 = __pyx_f_4gala_9optimized__row_match(__pyx_t_27, __pyx_t_28, __pyx_v_matches_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_27, 1);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_28, 1);
        __pyx_t_6 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_5, __pyx_int_neg_1, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_18 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 187; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (__pyx_t_18) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188:                     continue</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'>          goto __pyx_L9_continue;
        }
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line189")'> 189:                 if _list_match(acceptable, im[p[0],p[1],p[2]]) == -1:</pre>
<pre id='line189' class='code' style='background-color: #FFFF5e'>        __pyx_t_29 = 0;
        __pyx_t_25 = -1;
        if (__pyx_t_29 &lt; 0) {
          __pyx_t_29 += __pyx_pybuffernd_p.diminfo[0].shape;
          if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_29 &gt;= __pyx_pybuffernd_p.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_30 = 1;
        __pyx_t_25 = -1;
        if (__pyx_t_30 &lt; 0) {
          __pyx_t_30 += __pyx_pybuffernd_p.diminfo[0].shape;
          if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_30 &gt;= __pyx_pybuffernd_p.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_31 = 2;
        __pyx_t_25 = -1;
        if (__pyx_t_31 &lt; 0) {
          __pyx_t_31 += __pyx_pybuffernd_p.diminfo[0].shape;
          if (unlikely(__pyx_t_31 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_31 &gt;= __pyx_pybuffernd_p.diminfo[0].shape)) __pyx_t_25 = 0;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_32 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_29, __pyx_pybuffernd_p.diminfo[0].strides));
        __pyx_t_33 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_p.diminfo[0].strides));
        __pyx_t_34 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_31, __pyx_pybuffernd_p.diminfo[0].strides));
        __pyx_t_25 = -1;
        if (__pyx_t_32 &lt; 0) {
          __pyx_t_32 += __pyx_v_im.shape[0];
          if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_32 &gt;= __pyx_v_im.shape[0])) __pyx_t_25 = 0;
        if (__pyx_t_33 &lt; 0) {
          __pyx_t_33 += __pyx_v_im.shape[1];
          if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_25 = 1;
        } else if (unlikely(__pyx_t_33 &gt;= __pyx_v_im.shape[1])) __pyx_t_25 = 1;
        if (__pyx_t_34 &lt; 0) {
          __pyx_t_34 += __pyx_v_im.shape[2];
          if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_25 = 2;
        } else if (unlikely(__pyx_t_34 &gt;= __pyx_v_im.shape[2])) __pyx_t_25 = 2;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_6 = __pyx_f_4gala_9optimized__list_match(__pyx_v_acceptable, (*((long *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_im.data + __pyx_t_32 * __pyx_v_im.strides[0]) ) + __pyx_t_33 * __pyx_v_im.strides[1]) ) + __pyx_t_34 * __pyx_v_im.strides[2]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_6, __pyx_int_neg_1, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_18 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_18) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190:                     continue</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'>          goto __pyx_L9_continue;
        }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line191")'> 191:                 new_frontier[new_frontier_size] = p</pre>
<pre id='line191' class='code' style='background-color: #FFFFd4'>        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_new_frontier), __pyx_v_new_frontier_size, ((PyObject *)__pyx_v_p), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line192")'> 192:                 matches[matches_size] = p</pre>
<pre id='line192' class='code' style='background-color: #FFFFd4'>        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_matches), __pyx_v_matches_size, ((PyObject *)__pyx_v_p), int, 1, __Pyx_PyInt_From_int, 0, 1, 1) &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:                 matches_size += 1</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'>        __pyx_v_matches_size = (__pyx_v_matches_size + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:                 new_frontier_size += 1</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'>        __pyx_v_new_frontier_size = (__pyx_v_new_frontier_size + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:                 if matches_size &gt;= matches.shape[0]:</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'>        __pyx_t_18 = ((__pyx_v_matches_size &gt;= (__pyx_v_matches-&gt;dimensions[0])) != 0);
        if (__pyx_t_18) {
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line196")'> 196:                     matches = _expand_2darray(matches)</pre>
<pre id='line196' class='code' style='background-color: #FFFF52'>          __pyx_t_35 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_matches));
          if (unlikely(!__pyx_t_35.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __pyx_t_5 = ((PyObject *)__pyx_f_4gala_9optimized__expand_2darray(__pyx_t_35));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __PYX_XDEC_MEMVIEW(&amp;__pyx_t_35, 1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_5), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_25 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_22, &amp;__pyx_t_21, &amp;__pyx_t_20);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_matches, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_20);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_22, __pyx_t_21, __pyx_t_20);
              }
            }
            __pyx_pybuffernd_matches.diminfo[0].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_matches.diminfo[0].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_matches.diminfo[1].strides = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_matches.diminfo[1].shape = __pyx_pybuffernd_matches.rcbuffer-&gt;pybuffer.shape[1];
            if (unlikely(__pyx_t_25 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_matches, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
          goto __pyx_L14;
        }
        __pyx_L14:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:                 if new_frontier_size &gt;= new_frontier.shape[0]:</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'>        __pyx_t_18 = ((__pyx_v_new_frontier_size &gt;= (__pyx_v_new_frontier-&gt;dimensions[0])) != 0);
        if (__pyx_t_18) {
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line198")'> 198:                     new_frontier = _expand_2darray(new_frontier)</pre>
<pre id='line198' class='code' style='background-color: #FFFF52'>          __pyx_t_35 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_new_frontier));
          if (unlikely(!__pyx_t_35.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __pyx_t_5 = ((PyObject *)__pyx_f_4gala_9optimized__expand_2darray(__pyx_t_35));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __PYX_XDEC_MEMVIEW(&amp;__pyx_t_35, 1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_5), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_25 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_20, &amp;__pyx_t_21, &amp;__pyx_t_22);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_new_frontier, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_20, __pyx_t_21, __pyx_t_22);
              }
            }
            __pyx_pybuffernd_new_frontier.diminfo[0].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new_frontier.diminfo[0].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_new_frontier.diminfo[1].strides = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_new_frontier.diminfo[1].shape = __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.shape[1];
            if (unlikely(__pyx_t_25 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_new_frontier, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line199")'> 199:                     frontier = _expand_2darray(frontier)</pre>
<pre id='line199' class='code' style='background-color: #FFFF52'>          __pyx_t_35 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_frontier));
          if (unlikely(!__pyx_t_35.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __pyx_t_5 = ((PyObject *)__pyx_f_4gala_9optimized__expand_2darray(__pyx_t_35));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __PYX_XDEC_MEMVIEW(&amp;__pyx_t_35, 1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer);
            __pyx_t_25 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_5), &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_25 &lt; 0)) {
              <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_22, &amp;__pyx_t_21, &amp;__pyx_t_20);
              if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_frontier, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_20);
                <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
              } else {
                <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_22, __pyx_t_21, __pyx_t_20);
              }
            }
            __pyx_pybuffernd_frontier.diminfo[0].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_frontier.diminfo[0].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_frontier.diminfo[1].strides = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_frontier.diminfo[1].shape = __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.shape[1];
            if (unlikely(__pyx_t_25 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_frontier, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
          goto __pyx_L15;
        }
        __pyx_L15:;
        __pyx_L9_continue:;
      }
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:         for p_ii in range(new_frontier_size):</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_new_frontier_size;
    for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_3; __pyx_t_10+=1) {
      __pyx_v_p_ii = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:             for jj in range(new_frontier.shape[1]):</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'>      __pyx_t_24 = (__pyx_v_new_frontier-&gt;dimensions[1]);
      for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_24; __pyx_t_17+=1) {
        __pyx_v_jj = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line202")'> 202:                 frontier[p_ii,jj] = new_frontier[p_ii, jj]</pre>
<pre id='line202' class='code' style='background-color: #FFFFb6'>        __pyx_t_25 = __pyx_v_p_ii;
        __pyx_t_36 = __pyx_v_jj;
        __pyx_t_37 = -1;
        if (__pyx_t_25 &lt; 0) {
          __pyx_t_25 += __pyx_pybuffernd_new_frontier.diminfo[0].shape;
          if (unlikely(__pyx_t_25 &lt; 0)) __pyx_t_37 = 0;
        } else if (unlikely(__pyx_t_25 &gt;= __pyx_pybuffernd_new_frontier.diminfo[0].shape)) __pyx_t_37 = 0;
        if (__pyx_t_36 &lt; 0) {
          __pyx_t_36 += __pyx_pybuffernd_new_frontier.diminfo[1].shape;
          if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_37 = 1;
        } else if (unlikely(__pyx_t_36 &gt;= __pyx_pybuffernd_new_frontier.diminfo[1].shape)) __pyx_t_37 = 1;
        if (unlikely(__pyx_t_37 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_37);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_37 = __pyx_v_p_ii;
        __pyx_t_38 = __pyx_v_jj;
        __pyx_t_39 = -1;
        if (__pyx_t_37 &lt; 0) {
          __pyx_t_37 += __pyx_pybuffernd_frontier.diminfo[0].shape;
          if (unlikely(__pyx_t_37 &lt; 0)) __pyx_t_39 = 0;
        } else if (unlikely(__pyx_t_37 &gt;= __pyx_pybuffernd_frontier.diminfo[0].shape)) __pyx_t_39 = 0;
        if (__pyx_t_38 &lt; 0) {
          __pyx_t_38 += __pyx_pybuffernd_frontier.diminfo[1].shape;
          if (unlikely(__pyx_t_38 &lt; 0)) __pyx_t_39 = 1;
        } else if (unlikely(__pyx_t_38 &gt;= __pyx_pybuffernd_frontier.diminfo[1].shape)) __pyx_t_39 = 1;
        if (unlikely(__pyx_t_39 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_39);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_frontier.rcbuffer-&gt;pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_frontier.diminfo[0].strides, __pyx_t_38, __pyx_pybuffernd_frontier.diminfo[1].strides) = (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_new_frontier.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_new_frontier.diminfo[0].strides, __pyx_t_36, __pyx_pybuffernd_new_frontier.diminfo[1].strides));
      }
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:         frontier_size = new_frontier_size</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'>    __pyx_v_frontier_size = __pyx_v_new_frontier_size;
  }
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line204")'> 204:     return matches[0:matches_size, :]</pre>
<pre id='line204' class='code' style='background-color: #FFFF43'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_matches_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_5, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_slice__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__8);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_matches), __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_6 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;
/* … */
  __pyx_slice__8 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__8);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205: </pre>
<pre id='line205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206: </pre>
<pre id='line206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line207")'> 207: cdef np.ndarray[np.int_t, ndim=2] _expand_2darray(long[:,:] a):</pre>
<pre id='line207' class='code' style='background-color: #FFFF62'>static PyArrayObject *__pyx_f_4gala_9optimized__expand_2darray(__Pyx_memviewslice __pyx_v_a) {
  int __pyx_v_ii;
  int __pyx_v_jj;
  PyArrayObject *__pyx_v_expanded = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_expanded;
  __Pyx_Buffer __pyx_pybuffer_expanded;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_expand_2darray", 0);
  __pyx_pybuffer_expanded.pybuffer.buf = NULL;
  __pyx_pybuffer_expanded.refcount = 0;
  __pyx_pybuffernd_expanded.data = NULL;
  __pyx_pybuffernd_expanded.rcbuffer = &amp;__pyx_pybuffer_expanded;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._expand_2darray", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_expanded);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:     """ Double the number of rows in a matrix and copy over the existing values</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:     """</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:     cdef int ii,jj</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line211")'> 211:     cdef np.ndarray[np.int_t, ndim=2] expanded = np.zeros([a.shape[0] * 2, a.shape[1]], dtype=np.int)</pre>
<pre id='line211' class='code' style='background-color: #FFFF27'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((__pyx_v_a.shape[0]) * 2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_a.shape[1]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_expanded = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_expanded.diminfo[0].strides = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_expanded.diminfo[0].shape = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_expanded.diminfo[1].strides = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_expanded.diminfo[1].shape = __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_expanded = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212:     for ii in range(a.shape[0]):</pre>
<pre id='line212' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = (__pyx_v_a.shape[0]);
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_ii = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213:         for jj in range(a.shape[1]):</pre>
<pre id='line213' class='code' style='background-color: #FFFFff'>    __pyx_t_9 = (__pyx_v_a.shape[1]);
    for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_9; __pyx_t_10+=1) {
      __pyx_v_jj = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line214")'> 214:             expanded[ii,jj] = a[ii,jj]</pre>
<pre id='line214' class='code' style='background-color: #FFFFb6'>      __pyx_t_11 = __pyx_v_ii;
      __pyx_t_12 = __pyx_v_jj;
      __pyx_t_13 = -1;
      if (__pyx_t_11 &lt; 0) {
        __pyx_t_11 += __pyx_v_a.shape[0];
        if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_a.shape[0])) __pyx_t_13 = 0;
      if (__pyx_t_12 &lt; 0) {
        __pyx_t_12 += __pyx_v_a.shape[1];
        if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_13 = 1;
      } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_a.shape[1])) __pyx_t_13 = 1;
      if (unlikely(__pyx_t_13 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_13 = __pyx_v_ii;
      __pyx_t_14 = __pyx_v_jj;
      __pyx_t_15 = -1;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_pybuffernd_expanded.diminfo[0].shape;
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_pybuffernd_expanded.diminfo[0].shape)) __pyx_t_15 = 0;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_pybuffernd_expanded.diminfo[1].shape;
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 1;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_pybuffernd_expanded.diminfo[1].shape)) __pyx_t_15 = 1;
      if (unlikely(__pyx_t_15 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_expanded.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_expanded.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_expanded.diminfo[1].strides) = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_a.data + __pyx_t_11 * __pyx_v_a.strides[0]) ) + __pyx_t_12 * __pyx_v_a.strides[1]) )));
    }
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line215")'> 215:     return expanded</pre>
<pre id='line215' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_expanded));
  __pyx_r = ((PyArrayObject *)__pyx_v_expanded);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216: </pre>
<pre id='line216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217: </pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line218")'> 218: cdef np.ndarray[np.int_t, ndim=2] _adjacent_points(long[:] point, long[:,:] limits):</pre>
<pre id='line218' class='code' style='background-color: #FFFF62'>static PyArrayObject *__pyx_f_4gala_9optimized__adjacent_points(__Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_limits) {
  int __pyx_v_dimensions;
  int __pyx_v_variants;
  int __pyx_v_v;
  int __pyx_v_d;
  int __pyx_v_s;
  int __pyx_v_new;
  int __pyx_v_ii;
  int __pyx_v_shifts[2];
  PyArrayObject *__pyx_v_adjacent = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_adjacent;
  __Pyx_Buffer __pyx_pybuffer_adjacent;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_adjacent_points", 0);
  __pyx_pybuffer_adjacent.pybuffer.buf = NULL;
  __pyx_pybuffer_adjacent.refcount = 0;
  __pyx_pybuffernd_adjacent.data = NULL;
  __pyx_pybuffernd_adjacent.rcbuffer = &amp;__pyx_pybuffer_adjacent;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("gala.optimized._adjacent_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_adjacent);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219:     """ Get all adjacent points to point that fall within limits.</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: </pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221:     Parameters</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222:     ----------</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223:     point : ndarray, 1 dimension, type long</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224:         the coordinates of an n-dimensional point</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225:     limits : ndarray, 2 dimensions, type long</pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:         point.shape[0] rows, 2 columns, each row of this array represents the</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:         lower and upper (inclusive) bounds of acceptable values for</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228:         points that are returned.</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229: </pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:     Returns</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231:     -------</pre>
<pre id='line231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232:     adjacent : ndarray, 2 dimensions, type long</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233:         2 rows for each "dimension" of point, one column for each dimension</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:         Each row represents an adjacent points to `point`. Invalid points are</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235:         left as -1 across all columns.</pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:     """</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237:     cdef int dimensions = point.shape[0]</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'>  __pyx_v_dimensions = (__pyx_v_point.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:     cdef int variants = dimensions * 2</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'>  __pyx_v_variants = (__pyx_v_dimensions * 2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:     cdef int v = -1</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'>  __pyx_v_v = -1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240:     cdef int d, s, new,ii</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:     cdef int[2] shifts</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line242")'> 242:     cdef np.ndarray[np.int_t, ndim=2] adjacent = np.ones([variants, dimensions], dtype=np.int)*-1</pre>
<pre id='line242' class='code' style='background-color: #FFFF27'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_variants);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_dimensions);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_5, __pyx_int_neg_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_int_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_adjacent = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_adjacent.diminfo[0].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_adjacent.diminfo[0].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_adjacent.diminfo[1].strides = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_adjacent.diminfo[1].shape = __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_adjacent = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243:     shifts[0] = -1</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'>  (__pyx_v_shifts[0]) = -1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:     shifts[1] = 1</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>  (__pyx_v_shifts[1]) = 1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:     for d in range(dimensions):</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = __pyx_v_dimensions;
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_d = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246:         for s in shifts:</pre>
<pre id='line246' class='code' style='background-color: #FFFFff'>    __pyx_t_10 = (__pyx_v_shifts + 2);
    for (__pyx_t_11 = __pyx_v_shifts; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11++) {
      __pyx_t_9 = __pyx_t_11;
      __pyx_v_s = (__pyx_t_9[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:             v += 1</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'>      __pyx_v_v = (__pyx_v_v + 1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line248")'> 248:             new = point[d] + s</pre>
<pre id='line248' class='code' style='background-color: #FFFFd4'>      __pyx_t_12 = __pyx_v_d;
      __pyx_t_13 = -1;
      if (__pyx_t_12 &lt; 0) {
        __pyx_t_12 += __pyx_v_point.shape[0];
        if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_point.shape[0])) __pyx_t_13 = 0;
      if (unlikely(__pyx_t_13 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_new = ((*((long *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_12 * __pyx_v_point.strides[0]) ))) + __pyx_v_s);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line249")'> 249:             if new &lt; limits[d,0] or new &gt; limits[d,1]:</pre>
<pre id='line249' class='code' style='background-color: #FFFFb6'>      __pyx_t_13 = __pyx_v_d;
      __pyx_t_14 = 0;
      __pyx_t_15 = -1;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_limits.shape[0];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_limits.shape[0])) __pyx_t_15 = 0;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_v_limits.shape[1];
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_15 = 1;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_limits.shape[1])) __pyx_t_15 = 1;
      if (unlikely(__pyx_t_15 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_16 = ((__pyx_v_new &lt; (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_limits.data + __pyx_t_13 * __pyx_v_limits.strides[0]) ) + __pyx_t_14 * __pyx_v_limits.strides[1]) )))) != 0);
      if (!__pyx_t_16) {
        __pyx_t_15 = __pyx_v_d;
        __pyx_t_17 = 1;
        __pyx_t_18 = -1;
        if (__pyx_t_15 &lt; 0) {
          __pyx_t_15 += __pyx_v_limits.shape[0];
          if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_18 = 0;
        } else if (unlikely(__pyx_t_15 &gt;= __pyx_v_limits.shape[0])) __pyx_t_18 = 0;
        if (__pyx_t_17 &lt; 0) {
          __pyx_t_17 += __pyx_v_limits.shape[1];
          if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_18 = 1;
        } else if (unlikely(__pyx_t_17 &gt;= __pyx_v_limits.shape[1])) __pyx_t_18 = 1;
        if (unlikely(__pyx_t_18 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_18);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_19 = ((__pyx_v_new &gt; (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_limits.data + __pyx_t_15 * __pyx_v_limits.strides[0]) ) + __pyx_t_17 * __pyx_v_limits.strides[1]) )))) != 0);
        __pyx_t_20 = __pyx_t_19;
      } else {
        __pyx_t_20 = __pyx_t_16;
      }
      if (__pyx_t_20) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250:                 continue</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'>        goto __pyx_L5_continue;
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:             for ii in range(dimensions):</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'>      __pyx_t_18 = __pyx_v_dimensions;
      for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_18; __pyx_t_21+=1) {
        __pyx_v_ii = __pyx_t_21;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line252")'> 252:                 adjacent[v,ii] = point[ii]</pre>
<pre id='line252' class='code' style='background-color: #FFFFb6'>        __pyx_t_22 = __pyx_v_ii;
        __pyx_t_23 = -1;
        if (__pyx_t_22 &lt; 0) {
          __pyx_t_22 += __pyx_v_point.shape[0];
          if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_23 = 0;
        } else if (unlikely(__pyx_t_22 &gt;= __pyx_v_point.shape[0])) __pyx_t_23 = 0;
        if (unlikely(__pyx_t_23 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_23);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_23 = __pyx_v_v;
        __pyx_t_24 = __pyx_v_ii;
        __pyx_t_25 = -1;
        if (__pyx_t_23 &lt; 0) {
          __pyx_t_23 += __pyx_pybuffernd_adjacent.diminfo[0].shape;
          if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_25 = 0;
        } else if (unlikely(__pyx_t_23 &gt;= __pyx_pybuffernd_adjacent.diminfo[0].shape)) __pyx_t_25 = 0;
        if (__pyx_t_24 &lt; 0) {
          __pyx_t_24 += __pyx_pybuffernd_adjacent.diminfo[1].shape;
          if (unlikely(__pyx_t_24 &lt; 0)) __pyx_t_25 = 1;
        } else if (unlikely(__pyx_t_24 &gt;= __pyx_pybuffernd_adjacent.diminfo[1].shape)) __pyx_t_25 = 1;
        if (unlikely(__pyx_t_25 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_adjacent.diminfo[0].strides, __pyx_t_24, __pyx_pybuffernd_adjacent.diminfo[1].strides) = (*((long *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_22 * __pyx_v_point.strides[0]) )));
      }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line253")'> 253:             adjacent[v, d] = new</pre>
<pre id='line253' class='code' style='background-color: #FFFFd4'>      __pyx_t_18 = __pyx_v_v;
      __pyx_t_21 = __pyx_v_d;
      __pyx_t_25 = -1;
      if (__pyx_t_18 &lt; 0) {
        __pyx_t_18 += __pyx_pybuffernd_adjacent.diminfo[0].shape;
        if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_25 = 0;
      } else if (unlikely(__pyx_t_18 &gt;= __pyx_pybuffernd_adjacent.diminfo[0].shape)) __pyx_t_25 = 0;
      if (__pyx_t_21 &lt; 0) {
        __pyx_t_21 += __pyx_pybuffernd_adjacent.diminfo[1].shape;
        if (unlikely(__pyx_t_21 &lt; 0)) __pyx_t_25 = 1;
      } else if (unlikely(__pyx_t_21 &gt;= __pyx_pybuffernd_adjacent.diminfo[1].shape)) __pyx_t_25 = 1;
      if (unlikely(__pyx_t_25 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_25);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_int_t *, __pyx_pybuffernd_adjacent.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_adjacent.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_adjacent.diminfo[1].strides) = __pyx_v_new;
      __pyx_L5_continue:;
    }
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line254")'> 254:     return adjacent</pre>
<pre id='line254' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_adjacent));
  __pyx_r = ((PyArrayObject *)__pyx_v_adjacent);
  goto __pyx_L0;
</pre></body></html>
